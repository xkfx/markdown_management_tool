<p id="-"><span style="text-decoration: underline;">闭包</span></p>
<p>1、注意：返回的函数内部不要使用<span style="background-color: #ffff99;">后续会发生变化</span>的变量。</p>
<div class="cnblogs_code">
<pre><span style="color: #0000ff;">def</span><span style="color: #000000;"> f():
    gs </span>=<span style="color: #000000;"> []
    </span><span style="color: #0000ff;">for</span> k <span style="color: #0000ff;">in</span> range(1, 4<span style="color: #000000;">):
        </span><span style="color: #0000ff;">def</span><span style="color: #000000;"> g(i):
            </span><span style="color: #0000ff;">return</span> i +<span style="color: #000000;"> k
        gs.append(g)
    </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> gs<br /></span></pre>
</div>
<p>例如这段代码感觉上应该返回三个函数分别return i+1、return i+2、return i+3（i为新函数参数），但事实却是得到了三个return i+3。</p>
<div class="cnblogs_code">
<pre>&gt;&gt;&gt; <span style="color: #0000ff;">from</span> test <span style="color: #0000ff;">import</span><span style="color: #000000;"> f
</span>&gt;&gt;&gt; g1, g2, g3 =<span style="color: #000000;"> f()
</span>&gt;&gt;&gt;<span style="color: #000000;"> g1(0)
</span>3
&gt;&gt;&gt;<span style="color: #000000;"> g2(0)
</span>3
&gt;&gt;&gt;<span style="color: #000000;"> g3(0)
</span>3</pre>
</div>
<p>&nbsp;</p>
<p>2、如果一定要得到return i+1、return i+2、return i+3这三个函数怎么办？<br />可以这样</p>
<div class="cnblogs_code">
<pre><span style="color: #0000ff;">def</span><span style="color: #000000;"> f():
    gs </span>=<span style="color: #000000;"> []
    gs.append(</span><span style="color: #0000ff;">lambda</span> x : x + 1<span style="color: #000000;">)
    gs.append(</span><span style="color: #0000ff;">lambda</span> x : x + 2<span style="color: #000000;">)
    gs.append(</span><span style="color: #0000ff;">lambda</span> x : x + 3<span style="color: #000000;">)
    </span><span style="color: #0000ff;">return</span> gs</pre>
</div>
<p>但是要得到return i + 1 ~ return i + 100就行不通了，这时候可以</p>
<div class="cnblogs_code">
<pre><span style="color: #0000ff;">def</span><span style="color: #000000;"> f():
    hs </span>=<span style="color: #000000;"> []
    </span><span style="color: #0000ff;">def</span><span style="color: #000000;"> g(i):
        </span><span style="color: #0000ff;">def</span><span style="color: #000000;"> h(j):
            </span><span style="color: #0000ff;">return</span> j +<span style="color: #000000;"> i
        </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> h
    </span><span style="color: #0000ff;">for</span> k <span style="color: #0000ff;">in</span> range(1, 3<span style="color: #000000;">):
        hs.append(g(k))
    </span><span style="color: #0000ff;">return</span> hs</pre>
</div>
<p>这段代码可以这样看：f()最终返回一个函数list-&gt;hs，那么hs需要append什么呢？append n个reuturn i+n函数。这些函数又怎么得到呢？利用内部的函数返回得到。更清晰的版本：</p>
<div class="cnblogs_code">
<pre><span style="color: #0000ff;">def</span><span style="color: #000000;"> f():
    </span><span style="color: #008000;">#</span><span style="color: #008000;"> 返回函数的函数</span>
    <span style="color: #0000ff;">def</span><span style="color: #000000;"> g(i):
        </span><span style="color: #0000ff;">return</span> <span style="color: #0000ff;">lambda</span> j : i +<span style="color: #000000;"> j
    </span><span style="color: #008000;">#</span><span style="color: #008000;"> 获取元素为函数的list</span>
    hs =<span style="color: #000000;"> []
    </span><span style="color: #0000ff;">for</span> k <span style="color: #0000ff;">in</span> range(1, 5<span style="color: #000000;">):
        hs.append(g(k))
    </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> hs<br /></span></pre>
</div>
<p>&nbsp;</p>
<p><span style="text-decoration: underline;">匿名函数=lambda</span></p>