<p><a href="#a1">&nbsp;对于session的&ldquo;CRUD&rdquo;</a></p>
<p><a href="#a4">会话迁移</a></p>
<p><a href="#a5">别忘了HttpSessionBindingListener</a></p>
<p><a href="#a6">Listener示例</a></p>
<p>&nbsp;</p>
<p><a name="a1"></a>1、<strong>session的&ldquo;增&rdquo;与&ldquo;删&rdquo;</strong>&mdash;&mdash;session的创建和撤销的调用主体是服务端。</p>
<p><img src="http://images2015.cnblogs.com/blog/1042431/201706/1042431-20170609083346700-1249445038.png" alt="" width="679" height="202" /></p>
<p>&nbsp;</p>
<p><a name="a2"></a>2、<strong>session的&ldquo;改&rdquo;</strong>&mdash;&mdash;由各个servlet执行</p>
<p><img src="http://images2015.cnblogs.com/blog/1042431/201706/1042431-20170609083408965-1434674100.png" alt="" width="699" height="214" /></p>
<p>&nbsp;</p>
<p><a name="a3"></a>3、<strong>那么session的&ldquo;查找&rdquo;呢？</strong>&mdash;&mdash;依赖于客户端发来的JSESSIONID，以及服务端调用getSession()</p>
<p>&nbsp;</p>
<p><a name="a4"></a>4、会话迁移</p>
<ol>
<li>&nbsp;很重要的一句话&mdash;&mdash;<strong>&ldquo;<span style="color: #ff0000;">HttpSession只有一个！</span>&rdquo;</strong>不论有多少个VM。</li>
<li>迁移的发生：负载平衡服务器接到一个会话id为1的请求，把它交给容器1，结果容器1发现会话id为1的那个session在容器2中，迁移就开始了...</li>
<li>迁移的意味：在起点vm上&ldquo;钝化&rdquo;，在终点vm上激活。</li>
</ol>
<p>&nbsp;具体方法暂略。</p>
<p>&nbsp;</p>
<p><a name="a5"></a>5、别忘了HttpSessionBindingListener</p>
<p><img src="http://images2015.cnblogs.com/blog/1042431/201706/1042431-20170609084140747-1111191143.png" alt="" width="543" height="217" /></p>
<p><img src="http://images2015.cnblogs.com/blog/1042431/201706/1042431-20170609084220606-1930854384.png" alt="" width="384" height="179" /></p>
<p>&nbsp;</p>
<p><a name="a6"></a>6、Listener示例</p>
<p>跟踪Web应用中的活动会话个数。</p>
<div class="cnblogs_code">
<pre><span style="color: #0000ff;">package</span><span style="color: #000000;"> com.example;

</span><span style="color: #0000ff;">import</span><span style="color: #000000;"> javax.servlet.http.HttpSessionEvent;
</span><span style="color: #0000ff;">import</span><span style="color: #000000;"> javax.servlet.http.HttpSessionListener;

</span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span> BeerSessionCounter <span style="color: #0000ff;">implements</span><span style="color: #000000;"> HttpSessionListener {

    </span><span style="color: #0000ff;">static</span> <span style="color: #0000ff;">private</span> <span style="color: #0000ff;">int</span><span style="color: #000000;"> activeSessions;

    </span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">static</span> <span style="color: #0000ff;">int</span> getActiveSessions() { <span style="color: #008000;">//</span><span style="color: #008000;"> 其它servlet、辅助类可以访问！</span>
        <span style="color: #0000ff;">return</span><span style="color: #000000;"> activeSessions;
    }

    @Override
    </span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> sessionCreated(HttpSessionEvent httpSessionEvent) {
        </span>++<span style="color: #000000;">activeSessions;
    }

    @Override
    </span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> sessionDestroyed(HttpSessionEvent httpSessionEvent) {
        </span>--<span style="color: #000000;">activeSessions;
    }
}</span></pre>
</div>
<div class="cnblogs_code">
<pre><span style="color: #0000ff;">&lt;?</span><span style="color: #ff00ff;">xml version="1.0" encoding="ISO-8859-1" </span><span style="color: #0000ff;">?&gt;</span>

<span style="color: #0000ff;">&lt;</span><span style="color: #800000;">web-app </span><span style="color: #ff0000;">xmlns</span><span style="color: #0000ff;">="http://java.sun.com/xml/ns/j2ee"</span><span style="color: #ff0000;">
         xmlns:xsi</span><span style="color: #0000ff;">="http://www.w3.org/2001/XMLSchema-instance"</span><span style="color: #ff0000;">
         xsi:schemaLocation</span><span style="color: #0000ff;">="http://java.sun.com/xml/ns/j2ee http://java.sun.com/xml/ns/j2ee/web-app_2_4.xsd"</span><span style="color: #ff0000;">
         version</span><span style="color: #0000ff;">="2.4"</span><span style="color: #0000ff;">&gt;</span>

    <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">servlet</span><span style="color: #0000ff;">&gt;</span>
        <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">servlet-name</span><span style="color: #0000ff;">&gt;</span>Ch3 Beer<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">servlet-name</span><span style="color: #0000ff;">&gt;</span>
        <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">servlet-class</span><span style="color: #0000ff;">&gt;</span>com.example.web.BeerSelect<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">servlet-class</span><span style="color: #0000ff;">&gt;</span>
    <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">servlet</span><span style="color: #0000ff;">&gt;</span>

    <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">servlet-mapping</span><span style="color: #0000ff;">&gt;</span>
        <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">servlet-name</span><span style="color: #0000ff;">&gt;</span>Ch3 Beer<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">servlet-name</span><span style="color: #0000ff;">&gt;</span>
        <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">url-pattern</span><span style="color: #0000ff;">&gt;</span>/SelectBeer.do<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">url-pattern</span><span style="color: #0000ff;">&gt;</span>
    <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">servlet-mapping</span><span style="color: #0000ff;">&gt;</span>
    
    <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">listener</span><span style="color: #0000ff;">&gt;</span>
        <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">listener-class</span><span style="color: #0000ff;">&gt;</span><span style="color: #000000;">
            com.example.BeerSessionCounter
        </span><span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">listener-class</span><span style="color: #0000ff;">&gt;</span>
    <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">listener</span><span style="color: #0000ff;">&gt;</span>

<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">web-app</span><span style="color: #0000ff;">&gt;</span></pre>
</div>
<p>&nbsp;</p>