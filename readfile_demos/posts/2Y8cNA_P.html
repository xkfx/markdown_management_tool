<p>接笔记15.</p>
<p>1、不管是JSP中的&lt;%%&gt;还是&lt;%\=%&gt;最终都将处于servlet的方法体中，那么有没有一种元素可以声明成类的成员呢？</p>
<p>&mdash;&mdash;答案是有，而且非常非常简单，这个元素就是&lt;%!%&gt;，我们用它来解决笔记15中的问题，只需要在原基础上加一个感叹号就可以了。</p>
<div class="cnblogs_code">
<pre>&lt;%@ page <span style="color: #0000ff;">import</span>="Sample.Counter" %&gt;
&lt;%@ page contentType="text/html;charset=UTF-8" language="java" %&gt;
&lt;html&gt;
&lt;head&gt;
    &lt;title&gt;Basic Counter&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
<span style="color: #ff0000;">&lt;%<span style="font-size: 18pt;"><strong>!</strong></span></span>
    <span style="color: #0000ff;">int</span> count = 0<span style="color: #000000;">;
</span>%&gt;
&lt;p&gt;The page count is: &lt;/p&gt;
<span style="color: #ff0000;">&lt;%= ++count %&gt;</span>
&lt;/body&gt;
&lt;/html&gt;</pre>
</div>
<p>&nbsp;</p>
<p>2、我们还可以在感叹号里添加类的成员方法。</p>
<p><img src="http://images2015.cnblogs.com/blog/1042431/201706/1042431-20170614163410446-1245599275.png" alt="" width="404" height="116" /></p>
<p>&nbsp;</p>
<h2>JSP隐式对象（内置对象）</h2>
<p>1、out并不是唯一的JSP内置对象！</p>
<p>什么是JSP内置对象呢？本质上来说，所有的JSP内置对象最终都将映射为Servlet/JSP API中的某个东西。</p>
<p>例如，内置对象request实质上就是service的参数HttpServletRequest的一个映射。</p>
<p><img src="http://images2015.cnblogs.com/blog/1042431/201706/1042431-20170614170159040-377961185.png" alt="" width="717" height="348" /></p>
<p>&nbsp;</p>
<p>2、课本练习</p>
<p><img src="http://images2015.cnblogs.com/blog/1042431/201706/1042431-20170614171017868-847714876.png" alt="" width="618" height="261" /></p>
<p>index.html</p>
<div class="cnblogs_code">
<pre><span style="color: #0000ff;">&lt;!</span><span style="color: #ff00ff;">DOCTYPE html</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #0000ff;">&lt;</span><span style="color: #800000;">html </span><span style="color: #ff0000;">lang</span><span style="color: #0000ff;">="en"</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #0000ff;">&lt;</span><span style="color: #800000;">head</span><span style="color: #0000ff;">&gt;</span>
    <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">meta </span><span style="color: #ff0000;">charset</span><span style="color: #0000ff;">="UTF-8"</span><span style="color: #0000ff;">&gt;</span>
    <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">title</span><span style="color: #0000ff;">&gt;&lt;/</span><span style="color: #800000;">title</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">head</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #0000ff;">&lt;</span><span style="color: #800000;">body</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #0000ff;">&lt;</span><span style="color: #800000;">form </span><span style="color: #ff0000;">action</span><span style="color: #0000ff;">="HobbyPage.do"</span><span style="color: #ff0000;"> method</span><span style="color: #0000ff;">="post"</span><span style="color: #0000ff;">&gt;</span>
    <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">p</span><span style="color: #0000ff;">&gt;</span>choose a hobby:<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">p</span><span style="color: #0000ff;">&gt;</span>
    <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">select </span><span style="color: #ff0000;">name</span><span style="color: #0000ff;">="hobby"</span><span style="color: #ff0000;"> id</span><span style="color: #0000ff;">=""</span><span style="color: #ff0000;"> size</span><span style="color: #0000ff;">="1"</span><span style="color: #0000ff;">&gt;</span>
        <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">option </span><span style="color: #ff0000;">value</span><span style="color: #0000ff;">="看书"</span><span style="color: #0000ff;">&gt;</span>看书<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">option</span><span style="color: #0000ff;">&gt;</span>
        <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">option </span><span style="color: #ff0000;">value</span><span style="color: #0000ff;">="打王者荣耀"</span><span style="color: #0000ff;">&gt;</span>打王者荣耀<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">option</span><span style="color: #0000ff;">&gt;</span>
        <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">option </span><span style="color: #ff0000;">value</span><span style="color: #0000ff;">="写代码"</span><span style="color: #0000ff;">&gt;</span>写代码<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">option</span><span style="color: #0000ff;">&gt;</span>
        <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">option </span><span style="color: #ff0000;">value</span><span style="color: #0000ff;">="水群"</span><span style="color: #0000ff;">&gt;</span>水群<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">option</span><span style="color: #0000ff;">&gt;</span>
    <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">select</span><span style="color: #0000ff;">&gt;</span>
    <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">br </span><span style="color: #0000ff;">/&gt;</span>
    <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">input </span><span style="color: #ff0000;">type</span><span style="color: #0000ff;">="submit"</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">form</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">body</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">html</span><span style="color: #0000ff;">&gt;</span></pre>
</div>
<p>web.xml</p>
<div class="cnblogs_code">
<pre><span style="color: #0000ff;">&lt;?</span><span style="color: #ff00ff;">xml version="1.0" encoding="UTF-8"</span><span style="color: #0000ff;">?&gt;</span>
<span style="color: #0000ff;">&lt;</span><span style="color: #800000;">web-app </span><span style="color: #ff0000;">xmlns</span><span style="color: #0000ff;">="http://xmlns.jcp.org/xml/ns/javaee"</span><span style="color: #ff0000;">
         xmlns:xsi</span><span style="color: #0000ff;">="http://www.w3.org/2001/XMLSchema-instance"</span><span style="color: #ff0000;">
         xsi:schemaLocation</span><span style="color: #0000ff;">="http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_3_1.xsd"</span><span style="color: #ff0000;">
         version</span><span style="color: #0000ff;">="3.1"</span><span style="color: #0000ff;">&gt;</span>
    <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">servlet</span><span style="color: #0000ff;">&gt;</span>
        <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">servlet-name</span><span style="color: #0000ff;">&gt;</span>hi<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">servlet-name</span><span style="color: #0000ff;">&gt;</span>
        <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">servlet-class</span><span style="color: #0000ff;">&gt;</span>Sample.AddFriends<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">servlet-class</span><span style="color: #0000ff;">&gt;</span>
    <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">servlet</span><span style="color: #0000ff;">&gt;</span>

    <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">servlet-mapping</span><span style="color: #0000ff;">&gt;</span>
        <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">servlet-name</span><span style="color: #0000ff;">&gt;</span>hi<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">servlet-name</span><span style="color: #0000ff;">&gt;</span>
        <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">url-pattern</span><span style="color: #0000ff;">&gt;</span>/HobbyPage.do<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">url-pattern</span><span style="color: #0000ff;">&gt;</span>
    <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">servlet-mapping</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">web-app</span><span style="color: #0000ff;">&gt;</span></pre>
</div>
<p>AddFriends.java</p>
<div class="cnblogs_code">
<pre><span style="color: #0000ff;">package</span><span style="color: #000000;"> Sample;

</span><span style="color: #0000ff;">import</span><span style="color: #000000;"> javax.servlet.RequestDispatcher;
</span><span style="color: #0000ff;">import</span><span style="color: #000000;"> javax.servlet.ServletException;
</span><span style="color: #0000ff;">import</span><span style="color: #000000;"> javax.servlet.http.HttpServlet;
</span><span style="color: #0000ff;">import</span><span style="color: #000000;"> javax.servlet.http.HttpServletRequest;
</span><span style="color: #0000ff;">import</span><span style="color: #000000;"> javax.servlet.http.HttpServletResponse;
</span><span style="color: #0000ff;">import</span><span style="color: #000000;"> java.io.IOException;
</span><span style="color: #0000ff;">import</span><span style="color: #000000;"> java.util.ArrayList;
</span><span style="color: #0000ff;">import</span><span style="color: #000000;"> java.util.List;

</span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span> AddFriends <span style="color: #0000ff;">extends</span><span style="color: #000000;"> HttpServlet {
    @Override
    </span><span style="color: #0000ff;">protected</span> <span style="color: #0000ff;">void</span> doPost(HttpServletRequest req, HttpServletResponse resp) <span style="color: #0000ff;">throws</span><span style="color: #000000;"> ServletException, IOException {
        req.setCharacterEncoding(</span>"utf-8"<span style="color: #000000;">);

        List names </span>= <span style="color: #0000ff;">new</span><span style="color: #000000;"> ArrayList();
        names.add(</span>"Fred"<span style="color: #000000;">);
        names.add(</span>"Pradeep"<span style="color: #000000;">);
        names.add(</span>"Philippe"<span style="color: #000000;">);</span><span style="color: #000000;">

        req.setAttribute(</span>"names"<span style="color: #000000;">, names);
        RequestDispatcher view </span>= req.getRequestDispatcher("result.jsp"<span style="color: #000000;">);
        view.forward(req, resp);
    }
}</span></pre>
</div>
<p>result.jsp</p>
<div class="cnblogs_code">
<pre>&lt;%@ page <span style="color: #0000ff;">import</span>="java.util.List" %&gt;
&lt;%@ page <span style="color: #0000ff;">import</span>="java.util.Iterator" %&gt;&lt;%--<span style="color: #000000;">
  Created by IntelliJ IDEA.
  User: xkfx
  Date: </span>2017/6/14<span style="color: #000000;">
  Time: </span>17:27<span style="color: #000000;">
  To change </span><span style="color: #0000ff;">this</span> template use File | Settings |<span style="color: #000000;"> File Templates.
</span>--%&gt;
&lt;%@ page contentType="text/html;charset=UTF-8" language="java" %&gt;
&lt;html&gt;
&lt;head&gt;
    &lt;title&gt;Title&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;%
        <span style="color: #008000;">//</span><span style="color: #008000;"> response.setCharacterEncoding("utf-8");</span>
    %&gt;
    &lt;p&gt;hello i'm result&lt;/p&gt;
    &lt;p&gt;The friends who share your hobby &lt;%=request.getParameter("hobby")%&gt;  is :&lt;/p&gt;
    &lt;%<span style="color: #000000;">
        List names </span>= (List) request.getAttribute("names"<span style="color: #000000;">);
        Iterator it </span>=<span style="color: #000000;"> names.iterator();
        </span><span style="color: #0000ff;">while</span><span style="color: #000000;">(it.hasNext()) {
            out.println(it.next() </span>+ "&lt;br /&gt;"<span style="color: #000000;">);
        }
    </span>%&gt;
&lt;/body&gt;
&lt;/html&gt;</pre>
</div>
<p>&nbsp;写这道题碰到的两个极端坑爹的地方：</p>
<ol>
<li>html中，submit的参数是value而不是文本！更详细可以参考这里：<a href="http://www.jianshu.com/p/be4d4ff0c816" target="_blank">Java Web开发之Servlet获取表单值</a><br /><br /></li>
<li>要想最终得到的html显示中文，既不是在AddFriends.java中<span style="text-decoration: underline;">&nbsp;resp.setCharacterEncoding("utf-8");</span>也不是在result.jsp中 <span style="text-decoration: underline;"><span style="text-decoration: underline;">&nbsp;response.setCharacterEncoding("utf-8"); </span></span>而是在AddFriends.java中<span style="text-decoration: underline;"><span style="text-decoration: underline;">&nbsp;</span></span><span style="color: #ff0000;"><strong><span style="text-decoration: underline;">req.setCharacterEncoding("utf-8"<span style="font-family: 'Courier New'; font-size: 12px;">);</span></span></strong></span></li>



</ol>