<div id="diy_right_menu">
<h2>索引</h2>
<ul><ol>
<li><a href="#anchor0">1、什么是 Session？</a></li>
<li><a href="#anchor1">2、Java 中的会话管理&mdash;&mdash; Cookie</a></li>
<li><a href="#anchor2">3、Java Servlet 中的 Session &mdash;&mdash; HttpSession</a>
<ul>
<li><a href="#anchor3">理解 JSESSIONID Cookie</a></li>
</ul>
</li>
<li><a href="#anchor4">4、Java Servlet 中的会话管理 - URL 重写</a></li>
</ol></ul>
</div>
<p><span style="color: #ff0000; font-family: 楷体;">参考谷歌翻译，原文地址：<a href="http://www.journaldev.com/1907/java-session-management-servlet-httpsession-url-rewriting" target="_blank">http://www.journaldev.com/1907/java-session-management-servlet-httpsession-url-rewriting</a></span></p>
<p><span style="font-family: 楷体;">&nbsp;</span></p>
<p><span style="font-family: 楷体;">Java Web 应用程序中的<strong>会话管理（</strong>Session Management<strong>）</strong>是一个非常有趣的话题。Java&nbsp;Servlet中的会话通过不同的方式进行管理，例如 Cookie，HttpSession&nbsp;API，URL 重写等。</span></p>
<p><span style="font-family: 楷体;">这是 Java Web 应用程序系列教程中的第三篇文章，您可能还需要先阅读两篇文章。</span></p>
<h1>Java 中的会话管理</h1>
<p><span style="font-family: 楷体;">本文旨在使用不同的技术和示例程序解释 servlet 中的会话管理。</span></p>
<ol>
<li><span style="font-family: 楷体;"><a href="#a1">什么是 Session？</a></span></li>
<li><span style="font-family: 楷体;"><a href="#a2">Java 中的会话管理&mdash;&mdash; Cookie</a></span></li>
<li><span style="font-family: 楷体;"><a href="#a3">Java Servlet 中的Session&mdash;&mdash; HttpSession</a></span></li>
<li><span style="font-family: 楷体;"><a href="#a4">Java Servlet 中的会话管理&mdash;&mdash; URL 重写</a></span></li>
</ol>
<h2><a name="anchor0"></a>1、什么是 Session？</h2>
<p><span style="font-family: 楷体;">HTTP 协议和 Web 服务器都是无状态的，这意味着对 Web 服务器而言，每个请求都是一个新的进程，它无法确定请求是否来自先前发送过请求的客户端。</span><br /><span style="font-family: 楷体;">但有时候，我们需要知道客户端是谁，并且相应地处理请求。例如，<strong>购物车应用程序</strong>应该知道谁正在发送添加商品的请求，谁正在发送结帐的请求，以便可以无误地进行收费或者把商品添加到正确的购物车中。</span><br /><span style="font-family: 楷体;">Session是客户端和服务器之间的<strong>会话状态</strong>，它可以由客户端和服务器之间的<strong>多个</strong>请求和响应组成。由于 HTTP 和 Web 服务器都是无状态的，维护会话的<strong>唯一方法</strong>是在每个请求和响应中传递关于会话的<strong>唯一信息（session id）</strong>。</span><br /><span style="font-family: 楷体;">我们可以通过以下几种方式在请求和响应中提供唯一的标识符。</span></p>
<ol>
<li><span style="font-family: 楷体;"><span class="goog-text-highlight">用户认证&mdash;&mdash;这是一种很常用的方法，用户从登录页面提供认证凭证，然后我们可以在服务器和客户端之间传递认证信息来维护会话。但是，</span>这并非是一个非常有效的方法，因为一旦相同的用户从不同的浏览器登录，它将无法正常地工作。</span></li>
<li><span style="font-family: 楷体;">HTML隐藏字段（HTML Hidden Field）&mdash;&mdash;我们可以在HTML中创建一个唯一的隐藏字段，当用户开始导航时，把它设置为对用户的唯一值，并跟踪会话。这种方法不能与超链接一起使用，因为它要求每次从客户端提交的表单都具备隐藏字段。此外，它不够安全，因为我们可以从HTML源代码中获得隐藏的字段值，并利用它来破坏会话。</span></li>
<li><span style="font-family: 楷体;">URL 重写（URL Rewriting）&mdash;&mdash;我们可以给每个请求和响应附加<strong>会话标识符参数</strong>，以跟踪会话。这是非常繁琐的，因为我们需要在每个响应中跟踪这个参数，并确保它不会与其他参数冲突。</span></li>
<li><span style="font-family: 楷体;">Cookie &mdash;&mdash; Cookie 是由Web服务器发送，并存储在浏览器中的小块信息。当进一步请求时，浏览器将 Cookie 添加到 Request Header 中，我们可以利用它来跟踪会话。但如果客户端禁用 cookies，那么它将不起作用。</span></li>
<li><span style="font-family: 楷体;">Session Management API &mdash;&mdash;会话管理 API 是基于上述方法构建的，用于会话跟踪。上述方法的一些主要缺点是：1）、大多数时候，我们不仅要跟踪会话，还需要将一些数据存储到会话中，以便在将来的请求中使用。如果我们试图实现这一点，需要付出很多努力。2）、所有上述方法本身都不完整，所有这些方法都会在特定情况下不起作用。因此，我们需要一种解决方案，可以利用这个方法在所有情况下提供会话管理。</span></li>






















































































</ol>
<p><span style="font-family: 楷体;">这就是为什么我们需要&nbsp;<strong>Session Management API</strong>，以及为什么J2EE技术附带了 Session Management API 供我们使用。</span></p>
<h2><a name="anchor1"></a>2、Java 中的会话管理&mdash;&mdash; Cookie</h2>
<p><span style="font-family: 楷体;">在Web应用程序中Cookie应用得很多，它可以根据你的选择来<strong>个性化响应</strong>或跟踪会话。在转到 Session Management API 之前，我想通过一个小型 Web 应用程序来展示如何利用 Cookie 跟踪会话。</span></p>
<p><span style="font-family: 楷体;">我们将创建一个具有如下图所示项目结构的动态 Web 应用程序&nbsp;ServletCookieExample。</span></p>
<p><span style="font-family: 楷体;">（原文 IDE 使用的是Eclipse，使用 Intellij Idea 的朋友可以参考<a href="http://www.cnblogs.com/yangyquin/p/5285272.html" target="_blank">Intellij Idea 创建Web项目入门&nbsp;by&nbsp;我是一名老菜鸟</a>）&nbsp;</span></p>
<p><span style="font-family: 楷体;"><img style="clear: both; display: block; margin: auto;" src="http://images2015.cnblogs.com/blog/1042431/201706/1042431-20170605222518981-1026986700.png" alt="" /></span></p>
<p><span style="font-family: 楷体;">web 应用程序的部署描述文件 web.xml：</span></p>
<div class="cnblogs_code">
<pre><span style="font-family: 楷体;"><span style="color: #0000ff;">&lt;?</span><span style="color: #ff00ff;">xml version="1.0" encoding="UTF-8"</span><span style="color: #0000ff;">?&gt;</span>
<span style="color: #0000ff;">&lt;</span><span style="color: #800000;">web-app </span><span style="color: #ff0000;">xmlns</span><span style="color: #0000ff;">="http://xmlns.jcp.org/xml/ns/javaee"</span><span style="color: #ff0000;">
         xmlns:xsi</span><span style="color: #0000ff;">="http://www.w3.org/2001/XMLSchema-instance"</span><span style="color: #ff0000;">
         xsi:schemaLocation</span><span style="color: #0000ff;">="http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_3_1.xsd"</span><span style="color: #ff0000;">
         version</span><span style="color: #0000ff;">="3.1"</span><span style="color: #0000ff;">&gt;</span>
    <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">display-name</span><span style="color: #0000ff;">&gt;</span>ServletCookieExample<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">display-name</span><span style="color: #0000ff;">&gt;</span>
    <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">welcome-file-list</span><span style="color: #0000ff;">&gt;</span>
        <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">welcome-file</span><span style="color: #0000ff;">&gt;</span>login.html<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">welcome-file</span><span style="color: #0000ff;">&gt;</span>
    <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">welcome-file-list</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">web-app</span><span style="color: #0000ff;">&gt;</span></span></pre>
</div>
<p><span style="background-color: #ffff99; color: #ff0000; font-family: 楷体;">【注释】&lt;display-name&gt; 元素是可选的，详细信息参考&nbsp;<a href="https://docs.oracle.com/cd/E13222_01/wls/docs81b/webapp/web_xml.html" target="_blank"><span style="background-color: #ffff99; color: #ff0000;">oracle 文档</span></a>；&lt;welcome-file-list&gt;元素同样是可选的，它是一个包含&lt;<span class="code">welcome-file&gt;</span>元素的有序列表，可以结合servlet-mapping使用，有兴趣可以参考这里<a href="http://wiki.metawerx.net/wiki/HowToUseAServletAsYourMainWebPage" target="_blank"><span style="background-color: #ffff99; color: #ff0000;">HowToUseAServletAsYourMainWebPage</span></a>。</span></p>
<p><span style="font-family: 楷体;">应用程序的欢迎页面是 login.html，我们将从用户那里获取身份验证的详细信息。</span></p>
<div class="cnblogs_code">
<pre><span style="font-family: 楷体;"><span style="color: #0000ff;">&lt;!</span><span style="color: #ff00ff;">DOCTYPE html</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #0000ff;">&lt;</span><span style="color: #800000;">html</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #0000ff;">&lt;</span><span style="color: #800000;">head</span><span style="color: #0000ff;">&gt;</span>
    <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">meta </span><span style="color: #ff0000;">charset</span><span style="color: #0000ff;">="US-ASCII"</span><span style="color: #0000ff;">&gt;</span>
    <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">title</span><span style="color: #0000ff;">&gt;</span>Login Page<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">title</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">head</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #0000ff;">&lt;</span><span style="color: #800000;">body</span><span style="color: #0000ff;">&gt;</span>

<span style="color: #0000ff;">&lt;</span><span style="color: #800000;">form </span><span style="color: #ff0000;">action</span><span style="color: #0000ff;">="LoginServlet"</span><span style="color: #ff0000;"> method</span><span style="color: #0000ff;">="post"</span><span style="color: #0000ff;">&gt;</span><span style="color: #000000;">

    Username: </span><span style="color: #0000ff;">&lt;</span><span style="color: #800000;">input </span><span style="color: #ff0000;">type</span><span style="color: #0000ff;">="text"</span><span style="color: #ff0000;"> name</span><span style="color: #0000ff;">="user"</span><span style="color: #0000ff;">&gt;</span>
    <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">br</span><span style="color: #0000ff;">&gt;</span><span style="color: #000000;">
    Password: </span><span style="color: #0000ff;">&lt;</span><span style="color: #800000;">input </span><span style="color: #ff0000;">type</span><span style="color: #0000ff;">="password"</span><span style="color: #ff0000;"> name</span><span style="color: #0000ff;">="pwd"</span><span style="color: #0000ff;">&gt;</span>
    <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">br</span><span style="color: #0000ff;">&gt;</span>
    <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">input </span><span style="color: #ff0000;">type</span><span style="color: #0000ff;">="submit"</span><span style="color: #ff0000;"> value</span><span style="color: #0000ff;">="Login"</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">form</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">body</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">html</span><span style="color: #0000ff;">&gt;</span></span></pre>
</div>
<p><span style="color: #ff0000; background-color: #ffff99; font-family: 楷体;">【注释】HTML tag 的百科全书，关于 input 元素的详细信息可以参考&mdash;&mdash;&gt;<a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/input" target="_blank"><span style="color: #ff0000; background-color: #ffff99;">&lt;input&gt;</span></a></span></p>
<p><span style="font-family: 楷体;">这是一个负责处理&ldquo;登录请求&rdquo;的 LoginServlet。</span></p>
<div class="cnblogs_code">
<pre><span style="font-family: 楷体;"><span style="color: #0000ff;">package</span><span style="color: #000000;"> com.journaldev.servlet.session;

</span><span style="color: #0000ff;">import</span><span style="color: #000000;"> java.io.IOException;
</span><span style="color: #0000ff;">import</span><span style="color: #000000;"> java.io.PrintWriter;

</span><span style="color: #0000ff;">import</span><span style="color: #000000;"> javax.servlet.RequestDispatcher;
</span><span style="color: #0000ff;">import</span><span style="color: #000000;"> javax.servlet.ServletException;
</span><span style="color: #0000ff;">import</span><span style="color: #000000;"> javax.servlet.annotation.WebServlet;
</span><span style="color: #0000ff;">import</span><span style="color: #000000;"> javax.servlet.http.Cookie;
</span><span style="color: #0000ff;">import</span><span style="color: #000000;"> javax.servlet.http.HttpServlet;
</span><span style="color: #0000ff;">import</span><span style="color: #000000;"> javax.servlet.http.HttpServletRequest;
</span><span style="color: #0000ff;">import</span><span style="color: #000000;"> javax.servlet.http.HttpServletResponse;

</span><span style="color: #008000;">/**</span><span style="color: #008000;">
 * Servlet implementation class LoginServlet
 </span><span style="color: #008000;">*/</span><span style="color: #000000;">
@WebServlet(</span>"/LoginServlet"<span style="color: #000000;">)
</span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span> LoginServlet <span style="color: #0000ff;">extends</span><span style="color: #000000;"> HttpServlet {
    </span><span style="color: #0000ff;">private</span> <span style="color: #0000ff;">static</span> <span style="color: #0000ff;">final</span> <span style="color: #0000ff;">long</span> serialVersionUID = 1L<span style="color: #000000;">;
    </span><span style="color: #0000ff;">private</span> <span style="color: #0000ff;">final</span> String userID = "Pankaj"<span style="color: #000000;">;
    </span><span style="color: #0000ff;">private</span> <span style="color: #0000ff;">final</span> String password = "journaldev"<span style="color: #000000;">;

    </span><span style="color: #0000ff;">protected</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> doPost(HttpServletRequest request,
                          HttpServletResponse response) </span><span style="color: #0000ff;">throws</span><span style="color: #000000;"> ServletException, IOException {

        </span><span style="color: #008000;">//</span><span style="color: #008000;"> get request parameters for userID and password</span>
        String user = request.getParameter("user"<span style="color: #000000;">);
        String pwd </span>= request.getParameter("pwd"<span style="color: #000000;">);

        </span><span style="color: #0000ff;">if</span>(userID.equals(user) &amp;&amp;<span style="color: #000000;"> password.equals(pwd)){
            Cookie loginCookie </span>= <span style="color: #0000ff;">new</span> Cookie("user"<span style="color: #000000;">,user);
            </span><span style="color: #008000;">//</span><span style="color: #008000;">setting cookie to expiry in 30 mins</span>
            loginCookie.setMaxAge(30*60<span style="color: #000000;">);
            response.addCookie(loginCookie);
            response.sendRedirect(</span>"LoginSuccess.jsp"<span style="color: #000000;">);
        }</span><span style="color: #0000ff;">else</span><span style="color: #000000;">{
            RequestDispatcher rd </span>= getServletContext().getRequestDispatcher("/login.html"<span style="color: #000000;">);
            PrintWriter out</span>=<span style="color: #000000;"> response.getWriter();
            out.println(</span>"&lt;font color=red&gt;Either user name or password is wrong.&lt;/font&gt;"<span style="color: #000000;">);
            rd.include(request, response);
        }

    }

}</span></span></pre>
</div>
<p><span style="font-family: 楷体;">请注意我们设置在response中的cookie，它在之后将被转发到LoginSuccess.jsp，此cookie将用于跟踪会话。还要注意，&ldquo;cookie超时&rdquo;设置为30分钟。<span class="goog-text-highlight">理想情况下，应该有一个复杂的逻辑来设置跟踪会话的cookie值，以便它不会与别的请求相冲突。</span></span></p>
<div class="cnblogs_code">
<pre><span style="font-family: 楷体;">&lt;%@ page language="java" contentType="text/html; charset=US-ASCII"<span style="color: #000000;">
         pageEncoding</span>="US-ASCII"%&gt;
&lt;!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd"&gt;
&lt;html&gt;
&lt;head&gt;
    &lt;meta http-equiv="Content-Type" content="text/html; charset=US-ASCII"&gt;
    &lt;title&gt;Login Success Page&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;%<span style="color: #000000;">
    String userName </span>= <span style="color: #0000ff;">null</span><span style="color: #000000;">;
    Cookie[] cookies </span>=<span style="color: #000000;"> request.getCookies();
    </span><span style="color: #0000ff;">if</span>(cookies !=<span style="color: #0000ff;">null</span><span style="color: #000000;">){
        </span><span style="color: #0000ff;">for</span><span style="color: #000000;">(Cookie cookie : cookies){
            </span><span style="color: #0000ff;">if</span>(cookie.getName().equals("user")) userName =<span style="color: #000000;"> cookie.getValue();
        }
    }
    </span><span style="color: #0000ff;">if</span>(userName == <span style="color: #0000ff;">null</span>) response.sendRedirect("login.html"<span style="color: #000000;">);
</span>%&gt;
&lt;h3&gt;Hi &lt;%=userName %&gt;, Login successful.&lt;/h3&gt;
&lt;br&gt;
&lt;form action="LogoutServlet" method="post"&gt;
    &lt;input type="submit" value="Logout" &gt;
&lt;/form&gt;
&lt;/body&gt;
&lt;/html&gt;</span></pre>
</div>
<p><span style="font-family: 楷体;">请注意，如果尝试直接访问JSP，它将自动把我们转到&ldquo;登录页面&rdquo;。当我们点击注销按钮时，应该确保cookie已经从浏览器中删除。</span></p>
<div class="cnblogs_code">
<pre><span style="font-family: 楷体;"><span style="color: #0000ff;">package</span><span style="color: #000000;"> com.journaldev.servlet.session;

</span><span style="color: #0000ff;">import</span><span style="color: #000000;"> java.io.IOException;

</span><span style="color: #0000ff;">import</span><span style="color: #000000;"> javax.servlet.ServletException;
</span><span style="color: #0000ff;">import</span><span style="color: #000000;"> javax.servlet.annotation.WebServlet;
</span><span style="color: #0000ff;">import</span><span style="color: #000000;"> javax.servlet.http.Cookie;
</span><span style="color: #0000ff;">import</span><span style="color: #000000;"> javax.servlet.http.HttpServlet;
</span><span style="color: #0000ff;">import</span><span style="color: #000000;"> javax.servlet.http.HttpServletRequest;
</span><span style="color: #0000ff;">import</span><span style="color: #000000;"> javax.servlet.http.HttpServletResponse;

</span><span style="color: #008000;">/**</span><span style="color: #008000;">
 * Servlet implementation class LogoutServlet
 </span><span style="color: #008000;">*/</span><span style="color: #000000;">
@WebServlet(</span>"/LogoutServlet"<span style="color: #000000;">)
</span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span> LogoutServlet <span style="color: #0000ff;">extends</span><span style="color: #000000;"> HttpServlet {
    </span><span style="color: #0000ff;">private</span> <span style="color: #0000ff;">static</span> <span style="color: #0000ff;">final</span> <span style="color: #0000ff;">long</span> serialVersionUID = 1L<span style="color: #000000;">;

    </span><span style="color: #0000ff;">protected</span> <span style="color: #0000ff;">void</span> doPost(HttpServletRequest request, HttpServletResponse response) <span style="color: #0000ff;">throws</span><span style="color: #000000;"> ServletException, IOException {
        response.setContentType(</span>"text/html"<span style="color: #000000;">);
        Cookie loginCookie </span>= <span style="color: #0000ff;">null</span><span style="color: #000000;">;
        Cookie[] cookies </span>=<span style="color: #000000;"> request.getCookies();
        </span><span style="color: #0000ff;">if</span>(cookies != <span style="color: #0000ff;">null</span><span style="color: #000000;">){
            </span><span style="color: #0000ff;">for</span><span style="color: #000000;">(Cookie cookie : cookies){
                </span><span style="color: #0000ff;">if</span>(cookie.getName().equals("user"<span style="color: #000000;">)){
                    loginCookie </span>=<span style="color: #000000;"> cookie;
                    </span><span style="color: #0000ff;">break</span><span style="color: #000000;">;
                }
            }
        }
        </span><span style="color: #0000ff;">if</span>(loginCookie != <span style="color: #0000ff;">null</span><span style="color: #000000;">){
            loginCookie.setMaxAge(</span>0<span style="color: #000000;">);
            response.addCookie(loginCookie);
        }
        response.sendRedirect(</span>"login.html"<span style="color: #000000;">);
    }

}</span></span></pre>
</div>
<p><span style="font-family: 楷体;">没有方法可以删除cookie，但是我们可以将cookie的maximum age设置为0，它将立刻被浏览器移除。</span></p>
<p><span style="font-family: 楷体;">当我们运行上面的应用程序时，将得到如下响应。</span></p>
<p><span style="font-family: 楷体;"><img style="clear: both; display: block; margin: auto;" src="http://images2015.cnblogs.com/blog/1042431/201706/1042431-20170605224830481-1391268045.png" alt="" /></span></p>
<p><span style="font-family: 楷体;"><img style="clear: both; display: block; margin: auto;" src="http://images2015.cnblogs.com/blog/1042431/201706/1042431-20170605224839106-230773778.png" alt="" /></span></p>
<h2><a name="anchor2"></a>3、Java Servlet 中的 Session &mdash;&mdash; HttpSession</h2>
<p><span style="font-family: 楷体;">Servlet API通过<strong>Http Session接口</strong>提供会话管理。我们可以使用以下方法从HttpServletRequest对象中获取session。HttpSession允许我们将对象设置为属性，以便在将来的请求中能够检索。</span></p>
<ol>
<li><span style="font-family: 楷体;">HttpSession getSession()&nbsp;&ndash; 这个方法<strong>总是</strong>返回一个HttpSession对象，如果HttpServletRequest对象没有与session关联，则创建一个新的session返回。</span></li>
<li><span style="font-family: 楷体;">HttpSession getSession(boolean flag)&nbsp;&ndash; 返回一个HttpSession对象，如果HttpServletRequest对象没有与session关联就返回<strong>null</strong>。</span></li>
</ol>
<p><span style="font-family: 楷体;">HttpSession的一些重要方法是:</span></p>
<ol>
<li><span style="font-family: 楷体;">String getId()&nbsp;&ndash; 返回一个字符串，这个字符串包含了该session的唯一标识符。</span></li>
<li><span style="font-family: 楷体;"><strong>Object</strong> getAttribute(String name)&nbsp;&ndash; &nbsp;返回在session中用指定名称绑定的对象，如果没有对象绑定在该名称下，则返回null。其它与会话属性相关的方法是&nbsp;<code>getAttributeNames()</code>,&nbsp;<code>removeAttribute(String name)</code>&nbsp;和&nbsp;<code>setAttribute(String name, Object value)</code>.</span></li>
<li><span style="font-family: 楷体;">long getCreationTime()&nbsp;&ndash;&nbsp;返回此session创建的时间，起始时间是1970年1月1日GMT格林尼治时间，单位为毫秒。我们可以用<code>getLastAccessedTime()</code>方法获得最后访问的时间。</span></li>
<li><span style="font-family: 楷体;">setMaxInactiveInterval(int interval) &ndash; 用来指定&ldquo;session超时值&rdquo;，以秒为单位，servlet容器将会在这段时间内保持session有效，<span class="goog-text-highlight">我们可以用</span><code>getMaxInactiveInterval()</code><span class="goog-text-highlight">方法</span><span class="goog-text-highlight">获取&ldquo;session超时值&rdquo;。</span></span></li>
<li><span style="font-family: 楷体;">ServletContext getServletContext()&nbsp;&ndash; 返回Web应用的ServletContext对象。</span></li>
<li><span style="font-family: 楷体;">boolean isNew()&nbsp;&ndash;&nbsp;如果客户端还不知道会话或者客户端选择不加入会话，则返回true。</span></li>
<li><span style="font-family: 楷体;">void invalidate()&nbsp;&ndash; 使这个对话无效，并且解除所有绑定的对象。</span></li>
</ol>
<h3><a name="anchor3"></a>理解 JSESSIONID Cookie</h3>
<p><span style="font-family: 楷体;"><span class="goog-text-highlight">当使用HttpServletRequest的getSession()方法时，我们将获得一个新的HttpSession对象，与此同时，一个特殊的Cookie将被添加到对应的Response对象，这个Cookie名字叫做</span><strong>J</strong>SESSION<strong>ID</strong>，它的值就是&ldquo;<strong>session id</strong>&rdquo;<span class="goog-text-highlight">。</span>这个cookie用于在客户端的进一步请求中<strong>识别</strong>HttpSession对象。如果Cookie在客户端被禁用，并且我们正在使用URL重写，则该方法使用request URL中的<strong>J</strong>SESSION<strong>ID</strong>值来查找相应的会话。JSESSIONID cookie用于会话跟踪，因此我们不应该将其用于我们的应用程序，以避免造成任何会话相关的问题。</span></p>
<p><span style="font-family: 楷体;">让我们看看使用HttpSession对象的会话管理示例。我们将在Eclipse中创建一个动态Web项目，项目结构如下图所示。</span></p>
<p><span style="font-family: 楷体;"><img style="clear: both; display: block; margin: auto;" src="http://images2015.cnblogs.com/blog/1042431/201706/1042431-20170605212155918-877777709.png" alt="" /></span></p>
<p><span style="font-family: 楷体;">login.html与前面的示例一样，并定义应用程序的欢迎页面。</span></p>
<p><span style="font-family: 楷体;">LoginServlet servlet将创建session，并在其中<strong>设置</strong>我们可以在其他资源或将来请求中使用的<strong>属性</strong>。</span></p>
<div class="cnblogs_code">
<pre><span style="font-family: 楷体;"><span style="color: #0000ff;">package</span><span style="color: #000000;"> com.journaldev.servlet.session;

</span><span style="color: #0000ff;">import</span><span style="color: #000000;"> java.io.IOException;
</span><span style="color: #0000ff;">import</span><span style="color: #000000;"> java.io.PrintWriter;

</span><span style="color: #0000ff;">import</span><span style="color: #000000;"> javax.servlet.RequestDispatcher;
</span><span style="color: #0000ff;">import</span><span style="color: #000000;"> javax.servlet.ServletException;
</span><span style="color: #0000ff;">import</span><span style="color: #000000;"> javax.servlet.annotation.WebServlet;
</span><span style="color: #0000ff;">import</span><span style="color: #000000;"> javax.servlet.http.Cookie;
</span><span style="color: #0000ff;">import</span><span style="color: #000000;"> javax.servlet.http.HttpServlet;
</span><span style="color: #0000ff;">import</span><span style="color: #000000;"> javax.servlet.http.HttpServletRequest;
</span><span style="color: #0000ff;">import</span><span style="color: #000000;"> javax.servlet.http.HttpServletResponse;
</span><span style="color: #0000ff;">import</span><span style="color: #000000;"> javax.servlet.http.HttpSession;

</span><span style="color: #008000;">/**</span><span style="color: #008000;">
 * Servlet implementation class LoginServlet
 </span><span style="color: #008000;">*/</span><span style="color: #000000;">
@WebServlet(</span>"/LoginServlet"<span style="color: #000000;">)
</span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span> LoginServlet <span style="color: #0000ff;">extends</span><span style="color: #000000;"> HttpServlet {
    </span><span style="color: #0000ff;">private</span> <span style="color: #0000ff;">static</span> <span style="color: #0000ff;">final</span> <span style="color: #0000ff;">long</span> serialVersionUID = 1L<span style="color: #000000;">;
    </span><span style="color: #0000ff;">private</span> <span style="color: #0000ff;">final</span> String userID = "admin"<span style="color: #000000;">;
    </span><span style="color: #0000ff;">private</span> <span style="color: #0000ff;">final</span> String password = "password"<span style="color: #000000;">;

    </span><span style="color: #0000ff;">protected</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> doPost(HttpServletRequest request,
            HttpServletResponse response) </span><span style="color: #0000ff;">throws</span><span style="color: #000000;"> ServletException, IOException {

        </span><span style="color: #008000;">//</span><span style="color: #008000;"> get request parameters for userID and password</span>
        String user = request.getParameter("user"<span style="color: #000000;">);
        String pwd </span>= request.getParameter("pwd"<span style="color: #000000;">);
        
        </span><span style="color: #0000ff;">if</span>(userID.equals(user) &amp;&amp;<span style="color: #000000;"> password.equals(pwd)){
            HttpSession session </span>=<span style="color: #000000;"> request.getSession();
            session.setAttribute(</span>"user", "Pankaj"<span style="color: #000000;">);
            </span><span style="color: #008000;">//</span><span style="color: #008000;">setting session to expiry in 30 mins</span>
            session.setMaxInactiveInterval(30*60<span style="color: #000000;">);
            Cookie userName </span>= <span style="color: #0000ff;">new</span> Cookie("user"<span style="color: #000000;">, user);
            userName.setMaxAge(</span>30*60<span style="color: #000000;">);
            response.addCookie(userName);
            response.sendRedirect(</span>"LoginSuccess.jsp"<span style="color: #000000;">);
        }</span><span style="color: #0000ff;">else</span><span style="color: #000000;">{
            RequestDispatcher rd </span>= getServletContext().getRequestDispatcher("/login.html"<span style="color: #000000;">);
            PrintWriter out</span>=<span style="color: #000000;"> response.getWriter();
            out.println(</span>"&lt;font color=red&gt;Either user name or password is wrong.&lt;/font&gt;"<span style="color: #000000;">);
            rd.include(request, response);
        }

    }

}</span></span></pre>
</div>
<p><span style="font-family: 楷体;">我们的LoginSuccess.jsp&nbsp;如下所示。</span></p>
<div class="cnblogs_code">
<pre><span style="font-family: 楷体;">&lt;%@ page language="java" contentType="text/html; charset=US-ASCII"<span style="color: #000000;">
    pageEncoding</span>="US-ASCII"%&gt;
&lt;!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd"&gt;
&lt;html&gt;
&lt;head&gt;
&lt;meta http-equiv="Content-Type" content="text/html; charset=US-ASCII"&gt;
&lt;title&gt;Login Success Page&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;%
<span style="color: #008000;">//</span><span style="color: #008000;">allow access only if session exists</span>
String user = <span style="color: #0000ff;">null</span><span style="color: #000000;">;
</span><span style="color: #0000ff;">if</span>(session.getAttribute("user") == <span style="color: #0000ff;">null</span><span style="color: #000000;">){
    response.sendRedirect(</span>"login.html"<span style="color: #000000;">);
}</span><span style="color: #0000ff;">else</span> user = (String) session.getAttribute("user"<span style="color: #000000;">);
String userName </span>= <span style="color: #0000ff;">null</span><span style="color: #000000;">;
String sessionID </span>= <span style="color: #0000ff;">null</span><span style="color: #000000;">;
Cookie[] cookies </span>=<span style="color: #000000;"> request.getCookies();
</span><span style="color: #0000ff;">if</span>(cookies !=<span style="color: #0000ff;">null</span><span style="color: #000000;">){
</span><span style="color: #0000ff;">for</span><span style="color: #000000;">(Cookie cookie : cookies){
    </span><span style="color: #0000ff;">if</span>(cookie.getName().equals("user")) userName =<span style="color: #000000;"> cookie.getValue();
    </span><span style="color: #0000ff;">if</span>(cookie.getName().equals("JSESSIONID")) sessionID =<span style="color: #000000;"> cookie.getValue();
}
}
</span>%&gt;
&lt;h3&gt;Hi &lt;%=userName %&gt;, Login successful. Your Session ID=&lt;%=sessionID %&gt;&lt;/h3&gt;
&lt;br&gt;<span style="color: #000000;">
User</span>=&lt;%=user %&gt;
&lt;br&gt;
&lt;a href="CheckoutPage.jsp"&gt;Checkout Page&lt;/a&gt;
&lt;form action="LogoutServlet" method="post"&gt;
&lt;input type="submit" value="Logout" &gt;
&lt;/form&gt;
&lt;/body&gt;
&lt;/html&gt;</span></pre>
</div>
<p><span style="color: #ff0000; background-color: #ffff99; font-family: 楷体;">【注释】我们可以观察到，不论是在ServletLogin.java还是LoginSuccess.jsp中都没有手动创建JSESSIONED相关的cookie，然而，在我们第一次登陆的时候，可以在响应首部中看到Set-Cookie: JSESSIONID=2E2F69D80DF292A553719ACF32A901FF;&nbsp;</span></p>
<p><span style="font-family: 楷体;"><a href="http://images2015.cnblogs.com/blog/1042431/201706/1042431-20170607213936872-2084592400.png" target="_blank"><img style="clear: both; display: block; margin: auto;" src="http://images2015.cnblogs.com/blog/1042431/201706/1042431-20170607213936872-2084592400.png" alt="" /></a></span></p>
<p><span style="font-family: 楷体;">当使用JSP资源时，容器会自动为其创建一个session，所以我们不能检查会话是否为空，来确保用户是否通过登录页面，因此我们使用session的属性来验证请求。</span></p>
<p><span style="font-family: 楷体;">CheckoutPage.jsp是另外一个页面，它的代码如下所示。</span></p>
<div class="cnblogs_code">
<pre><span style="font-family: 楷体;">&lt;%@ page language="java" contentType="text/html; charset=US-ASCII"<span style="color: #000000;">
    pageEncoding</span>="US-ASCII"%&gt;
&lt;!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd"&gt;
&lt;html&gt;
&lt;head&gt;
&lt;meta http-equiv="Content-Type" content="text/html; charset=US-ASCII"&gt;
&lt;title&gt;Login Success Page&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;%
<span style="color: #008000;">//</span><span style="color: #008000;">allow access only if session exists</span>
<span style="color: #0000ff;">if</span>(session.getAttribute("user") == <span style="color: #0000ff;">null</span><span style="color: #000000;">){
    response.sendRedirect(</span>"login.html"<span style="color: #000000;">);
}
String userName </span>= <span style="color: #0000ff;">null</span><span style="color: #000000;">;
String sessionID </span>= <span style="color: #0000ff;">null</span><span style="color: #000000;">;
Cookie[] cookies </span>=<span style="color: #000000;"> request.getCookies();
</span><span style="color: #0000ff;">if</span>(cookies !=<span style="color: #0000ff;">null</span><span style="color: #000000;">){
</span><span style="color: #0000ff;">for</span><span style="color: #000000;">(Cookie cookie : cookies){
    </span><span style="color: #0000ff;">if</span>(cookie.getName().equals("user")) userName =<span style="color: #000000;"> cookie.getValue();
}
}
</span>%&gt;
&lt;h3&gt;Hi &lt;%=userName %&gt;, <span style="color: #0000ff;">do</span> the checkout.&lt;/h3&gt;
&lt;br&gt;
&lt;form action="LogoutServlet" method="post"&gt;
&lt;input type="submit" value="Logout" &gt;
&lt;/form&gt;
&lt;/body&gt;
&lt;/html&gt;</span></pre>
</div>
<p><span style="color: #ff0000; background-color: #ffff99; font-family: 楷体;">【注释】在点击CheckoutPage切换页面的时候，cookies将继续传递（包含user、JSESSIONID），而session也一直存在。</span></p>
<p><span style="font-family: 楷体;">我们的LogoutServlet代码如下所示。</span></p>
<div class="cnblogs_code">
<pre><span style="font-family: 楷体;"><span style="color: #0000ff;">package</span><span style="color: #000000;"> com.journaldev.servlet.session;

</span><span style="color: #0000ff;">import</span><span style="color: #000000;"> java.io.IOException;

</span><span style="color: #0000ff;">import</span><span style="color: #000000;"> javax.servlet.ServletException;
</span><span style="color: #0000ff;">import</span><span style="color: #000000;"> javax.servlet.annotation.WebServlet;
</span><span style="color: #0000ff;">import</span><span style="color: #000000;"> javax.servlet.http.Cookie;
</span><span style="color: #0000ff;">import</span><span style="color: #000000;"> javax.servlet.http.HttpServlet;
</span><span style="color: #0000ff;">import</span><span style="color: #000000;"> javax.servlet.http.HttpServletRequest;
</span><span style="color: #0000ff;">import</span><span style="color: #000000;"> javax.servlet.http.HttpServletResponse;
</span><span style="color: #0000ff;">import</span><span style="color: #000000;"> javax.servlet.http.HttpSession;

</span><span style="color: #008000;">/**</span><span style="color: #008000;">
 * Servlet implementation class LogoutServlet
 </span><span style="color: #008000;">*/</span><span style="color: #000000;">
@WebServlet(</span>"/LogoutServlet"<span style="color: #000000;">)
</span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span> LogoutServlet <span style="color: #0000ff;">extends</span><span style="color: #000000;"> HttpServlet {
    </span><span style="color: #0000ff;">private</span> <span style="color: #0000ff;">static</span> <span style="color: #0000ff;">final</span> <span style="color: #0000ff;">long</span> serialVersionUID = 1L<span style="color: #000000;">;
       
    </span><span style="color: #0000ff;">protected</span> <span style="color: #0000ff;">void</span> doPost(HttpServletRequest request, HttpServletResponse response) <span style="color: #0000ff;">throws</span><span style="color: #000000;"> ServletException, IOException {
        response.setContentType(</span>"text/html"<span style="color: #000000;">);
        Cookie[] cookies </span>=<span style="color: #000000;"> request.getCookies();
        </span><span style="color: #0000ff;">if</span>(cookies != <span style="color: #0000ff;">null</span><span style="color: #000000;">){
        </span><span style="color: #0000ff;">for</span><span style="color: #000000;">(Cookie cookie : cookies){
            </span><span style="color: #0000ff;">if</span>(cookie.getName().equals("JSESSIONID"<span style="color: #000000;">)){
                System.out.println(</span>"JSESSIONID="+<span style="color: #000000;">cookie.getValue());
                </span><span style="color: #0000ff;">break</span><span style="color: #000000;">;
            }
        }
        }
        </span><span style="color: #008000;">//</span><span style="color: #008000;">invalidate the session if exists</span>
        HttpSession session = request.getSession(<span style="color: #0000ff;">false</span><span style="color: #000000;">);
        System.out.println(</span>"User="+session.getAttribute("user"<span style="color: #000000;">));
        </span><span style="color: #0000ff;">if</span>(session != <span style="color: #0000ff;">null</span><span style="color: #000000;">){
            session.invalidate();
        }
        response.sendRedirect(</span>"login.html"<span style="color: #000000;">);
    }

}</span></span></pre>
</div>
<p><span style="background-color: #ffff99; color: #ff0000; font-family: 楷体;">【注释】退出前使session无效化，虽然这个时候JSESSIONID还保留在浏览器，但是当你重新登陆的时候，值就不再是原来那个值了（会被新的JSESSION值所覆盖）。</span></p>
<p><span style="font-family: 楷体;">请注意，我在日志中打印了JSESSIONID cookie的值，你可以检查服务器日志在哪里打印了与LoginSuccess.jsp中的Session id相同的值。</span></p>
<p><span style="font-family: 楷体;">下图显示了我们的Web应用程序的执行。</span></p>
<p><span style="font-family: 楷体;"><img style="clear: both; display: block; margin: auto;" src="http://images2015.cnblogs.com/blog/1042431/201706/1042431-20170605230742356-69867968.png" alt="" /></span></p>
<p><span style="font-family: 楷体;"><img style="clear: both; display: block; margin: auto;" src="http://images2015.cnblogs.com/blog/1042431/201706/1042431-20170605230749418-1792500347.png" alt="" /></span></p>
<p><span style="font-family: 楷体;"><img style="clear: both; display: block; margin: auto;" src="http://images2015.cnblogs.com/blog/1042431/201706/1042431-20170605230801262-1361028513.png" alt="" /></span></p>
<h2><a name="anchor4"></a>4、Java Servlet 中的会话管理 - URL 重写</h2>
<p><span style="font-family: 楷体;">正如我们在上一节中看到的，我们可以使用HttpSession来管理一个会话，但是如果我们在浏览器中禁用了cookies，它将不起作用，因为服务器将不会从客户端收到J<strong>SESSION</strong>ID cookie。Servlet API提供了对URL重写的支持，以便我们可以在这种情况下管理会话。</span></p>
<p><span style="font-family: 楷体;">从编码的角度来看，它很容易使用，它涉及到了一个步骤 - 编码URL（encoding the URL）。编码URL的另一个好处是它是一种&ldquo;后备方法&rdquo;，只有在浏览器Cookie被禁用的情况下才会启用。</span></p>
<p><span style="font-family: 楷体;">我们可以使用HttpServletResponse的&nbsp;<code>encodeURL()</code>方法对URL进行编码，如果我们必须将请求重定向到另一个资源，并且提供会话信息，那么我们可以使用<code>encodeRedirectURL()</code>方法。</span></p>
<p><span style="background-color: #ffff99; color: #ff0000; font-family: 楷体;">【注释】这段翻译得很乱！我在网上查了一些资料，对两者的差异仍没有搞清楚，encodeURL()和encodeRedirectURL()之间到底有什么区别呢？就输出的字符串值、和运行状况来看两者并没有差异。<img src="http://images2015.cnblogs.com/blog/1042431/201706/1042431-20170608144739356-164589949.png" alt="" width="349" height="110" /></span></p>
<p><span style="font-family: 楷体;">&nbsp;</span></p>
<p><span style="font-family: 楷体;">我们将创建一个类似的项目，这个项目将使用<strong>URL重写</strong>来确保会话管理工作正常（即使浏览器禁用了cookies）。</span></p>
<p><span style="font-family: 楷体;"><img style="clear: both; display: block; margin: auto;" src="http://images2015.cnblogs.com/blog/1042431/201706/1042431-20170605215528762-1110015089.png" alt="" /></span></p>
<div class="cnblogs_code">
<pre><span style="font-family: 楷体;"><span style="color: #0000ff;">package</span><span style="color: #000000;"> com.journaldev.servlet.session;

</span><span style="color: #0000ff;">import</span><span style="color: #000000;"> java.io.IOException;
</span><span style="color: #0000ff;">import</span><span style="color: #000000;"> java.io.PrintWriter;

</span><span style="color: #0000ff;">import</span><span style="color: #000000;"> javax.servlet.RequestDispatcher;
</span><span style="color: #0000ff;">import</span><span style="color: #000000;"> javax.servlet.ServletException;
</span><span style="color: #0000ff;">import</span><span style="color: #000000;"> javax.servlet.annotation.WebServlet;
</span><span style="color: #0000ff;">import</span><span style="color: #000000;"> javax.servlet.http.Cookie;
</span><span style="color: #0000ff;">import</span><span style="color: #000000;"> javax.servlet.http.HttpServlet;
</span><span style="color: #0000ff;">import</span><span style="color: #000000;"> javax.servlet.http.HttpServletRequest;
</span><span style="color: #0000ff;">import</span><span style="color: #000000;"> javax.servlet.http.HttpServletResponse;
</span><span style="color: #0000ff;">import</span><span style="color: #000000;"> javax.servlet.http.HttpSession;

</span><span style="color: #008000;">/**</span><span style="color: #008000;">
 * Servlet implementation class LoginServlet
 </span><span style="color: #008000;">*/</span><span style="color: #000000;">
@WebServlet(</span>"/LoginServlet"<span style="color: #000000;">)
</span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span> LoginServlet <span style="color: #0000ff;">extends</span><span style="color: #000000;"> HttpServlet {
    </span><span style="color: #0000ff;">private</span> <span style="color: #0000ff;">static</span> <span style="color: #0000ff;">final</span> <span style="color: #0000ff;">long</span> serialVersionUID = 1L<span style="color: #000000;">;
    </span><span style="color: #0000ff;">private</span> <span style="color: #0000ff;">final</span> String userID = "admin"<span style="color: #000000;">;
    </span><span style="color: #0000ff;">private</span> <span style="color: #0000ff;">final</span> String password = "password"<span style="color: #000000;">;

    </span><span style="color: #0000ff;">protected</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> doPost(HttpServletRequest request,
            HttpServletResponse response) </span><span style="color: #0000ff;">throws</span><span style="color: #000000;"> ServletException, IOException {

        </span><span style="color: #008000;">//</span><span style="color: #008000;"> get request parameters for userID and password</span>
        String user = request.getParameter("user"<span style="color: #000000;">);
        String pwd </span>= request.getParameter("pwd"<span style="color: #000000;">);
        
        </span><span style="color: #0000ff;">if</span>(userID.equals(user) &amp;&amp;<span style="color: #000000;"> password.equals(pwd)){
            HttpSession session </span>=<span style="color: #000000;"> request.getSession();
            session.setAttribute(</span>"user", "Pankaj"<span style="color: #000000;">);
            </span><span style="color: #008000;">//</span><span style="color: #008000;">setting session to expiry in 30 mins</span>
            session.setMaxInactiveInterval(30*60<span style="color: #000000;">);
            Cookie userName </span>= <span style="color: #0000ff;">new</span> Cookie("user"<span style="color: #000000;">, user);
            response.addCookie(userName);
            </span><span style="color: #008000;">//</span><span style="color: #008000;">Get the encoded URL string</span>
            String encodedURL = response.encodeRedirectURL("LoginSuccess.jsp"<span style="color: #000000;">);
            response.sendRedirect(encodedURL);
        }</span><span style="color: #0000ff;">else</span><span style="color: #000000;">{
            RequestDispatcher rd </span>= getServletContext().getRequestDispatcher("/login.html"<span style="color: #000000;">);
            PrintWriter out</span>=<span style="color: #000000;"> response.getWriter();
            out.println(</span>"&lt;font color=red&gt;Either user name or password is wrong.&lt;/font&gt;"<span style="color: #000000;">);
            rd.include(request, response);
        }

    }

}</span></span></pre>
</div>
<div class="cnblogs_code">
<pre><span style="font-family: 楷体;">&lt;%@ page language="java" contentType="text/html; charset=US-ASCII"<span style="color: #000000;">
    pageEncoding</span>="US-ASCII"%&gt;
&lt;!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd"&gt;
&lt;html&gt;
&lt;head&gt;
&lt;meta http-equiv="Content-Type" content="text/html; charset=US-ASCII"&gt;
&lt;title&gt;Login Success Page&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;%
<span style="color: #008000;">//</span><span style="color: #008000;">allow access only if session exists</span>
String user = <span style="color: #0000ff;">null</span><span style="color: #000000;">;
</span><span style="color: #0000ff;">if</span>(session.getAttribute("user") == <span style="color: #0000ff;">null</span><span style="color: #000000;">){
    response.sendRedirect(</span>"login.html"<span style="color: #000000;">);
}</span><span style="color: #0000ff;">else</span> user = (String) session.getAttribute("user"<span style="color: #000000;">);
String userName </span>= <span style="color: #0000ff;">null</span><span style="color: #000000;">;
String sessionID </span>= <span style="color: #0000ff;">null</span><span style="color: #000000;">;
Cookie[] cookies </span>=<span style="color: #000000;"> request.getCookies();
</span><span style="color: #0000ff;">if</span>(cookies !=<span style="color: #0000ff;">null</span><span style="color: #000000;">){
</span><span style="color: #0000ff;">for</span><span style="color: #000000;">(Cookie cookie : cookies){
    </span><span style="color: #0000ff;">if</span>(cookie.getName().equals("user")) userName =<span style="color: #000000;"> cookie.getValue();
    </span><span style="color: #0000ff;">if</span>(cookie.getName().equals("JSESSIONID")) sessionID =<span style="color: #000000;"> cookie.getValue();
}
}</span><span style="color: #0000ff;">else</span><span style="color: #000000;">{
    sessionID </span>=<span style="color: #000000;"> session.getId();
}
</span>%&gt;
&lt;h3&gt;Hi &lt;%=userName %&gt;, Login successful. Your Session ID=&lt;%=sessionID %&gt;&lt;/h3&gt;
&lt;br&gt;<span style="color: #000000;">
User</span>=&lt;%=user %&gt;
&lt;br&gt;
&lt;!-- need to encode all the URLs where we want session information to be passed --&gt;
&lt;a href="&lt;%=response.encodeURL("CheckoutPage.jsp") %&gt;"&gt;Checkout Page&lt;/a&gt;
&lt;form action="&lt;%=response.encodeURL("LogoutServlet") %&gt;" method="post"&gt;
&lt;input type="submit" value="Logout" &gt;
&lt;/form&gt;
&lt;/body&gt;
&lt;/html&gt;</span></pre>
</div>
<div class="cnblogs_code">
<pre><span style="font-family: 楷体;">&lt;%@ page language="java" contentType="text/html; charset=US-ASCII"<span style="color: #000000;">
    pageEncoding</span>="US-ASCII"%&gt;
&lt;!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd"&gt;
&lt;html&gt;
&lt;head&gt;
&lt;meta http-equiv="Content-Type" content="text/html; charset=US-ASCII"&gt;
&lt;title&gt;Login Success Page&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;%<span style="color: #000000;">
String userName </span>= <span style="color: #0000ff;">null</span><span style="color: #000000;">;
</span><span style="color: #008000;">//</span><span style="color: #008000;">allow access only if session exists</span>
<span style="color: #0000ff;">if</span>(session.getAttribute("user") == <span style="color: #0000ff;">null</span><span style="color: #000000;">){
    response.sendRedirect(</span>"login.html"<span style="color: #000000;">);
}</span><span style="color: #0000ff;">else</span> userName = (String) session.getAttribute("user"<span style="color: #000000;">);
String sessionID </span>= <span style="color: #0000ff;">null</span><span style="color: #000000;">;
Cookie[] cookies </span>=<span style="color: #000000;"> request.getCookies();
</span><span style="color: #0000ff;">if</span>(cookies !=<span style="color: #0000ff;">null</span><span style="color: #000000;">){
</span><span style="color: #0000ff;">for</span><span style="color: #000000;">(Cookie cookie : cookies){
    </span><span style="color: #0000ff;">if</span>(cookie.getName().equals("user")) userName =<span style="color: #000000;"> cookie.getValue();
}
}
</span>%&gt;
&lt;h3&gt;Hi &lt;%=userName %&gt;, <span style="color: #0000ff;">do</span> the checkout.&lt;/h3&gt;
&lt;br&gt;
&lt;form action="&lt;%=response.encodeURL("LogoutServlet") %&gt;" method="post"&gt;
&lt;input type="submit" value="Logout" &gt;
&lt;/form&gt;
&lt;/body&gt;
&lt;/html&gt;</span></pre>
</div>
<div class="cnblogs_code">
<pre><span style="font-family: 楷体;"><span style="color: #0000ff;">package</span><span style="color: #000000;"> com.journaldev.servlet.session;

</span><span style="color: #0000ff;">import</span><span style="color: #000000;"> java.io.IOException;

</span><span style="color: #0000ff;">import</span><span style="color: #000000;"> javax.servlet.ServletException;
</span><span style="color: #0000ff;">import</span><span style="color: #000000;"> javax.servlet.annotation.WebServlet;
</span><span style="color: #0000ff;">import</span><span style="color: #000000;"> javax.servlet.http.Cookie;
</span><span style="color: #0000ff;">import</span><span style="color: #000000;"> javax.servlet.http.HttpServlet;
</span><span style="color: #0000ff;">import</span><span style="color: #000000;"> javax.servlet.http.HttpServletRequest;
</span><span style="color: #0000ff;">import</span><span style="color: #000000;"> javax.servlet.http.HttpServletResponse;
</span><span style="color: #0000ff;">import</span><span style="color: #000000;"> javax.servlet.http.HttpSession;

</span><span style="color: #008000;">/**</span><span style="color: #008000;">
 * Servlet implementation class LogoutServlet
 </span><span style="color: #008000;">*/</span><span style="color: #000000;">
@WebServlet(</span>"/LogoutServlet"<span style="color: #000000;">)
</span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span> LogoutServlet <span style="color: #0000ff;">extends</span><span style="color: #000000;"> HttpServlet {
    </span><span style="color: #0000ff;">private</span> <span style="color: #0000ff;">static</span> <span style="color: #0000ff;">final</span> <span style="color: #0000ff;">long</span> serialVersionUID = 1L<span style="color: #000000;">;
       
    </span><span style="color: #0000ff;">protected</span> <span style="color: #0000ff;">void</span> doPost(HttpServletRequest request, HttpServletResponse response) <span style="color: #0000ff;">throws</span><span style="color: #000000;"> ServletException, IOException {
        response.setContentType(</span>"text/html"<span style="color: #000000;">);
        Cookie[] cookies </span>=<span style="color: #000000;"> request.getCookies();
        </span><span style="color: #0000ff;">if</span>(cookies != <span style="color: #0000ff;">null</span><span style="color: #000000;">){
        </span><span style="color: #0000ff;">for</span><span style="color: #000000;">(Cookie cookie : cookies){
            </span><span style="color: #0000ff;">if</span>(cookie.getName().equals("JSESSIONID"<span style="color: #000000;">)){
                System.out.println(</span>"JSESSIONID="+<span style="color: #000000;">cookie.getValue());
            }
            cookie.setMaxAge(</span>0<span style="color: #000000;">);
            response.addCookie(cookie);
        }
        }
        </span><span style="color: #008000;">//</span><span style="color: #008000;">invalidate the session if exists</span>
        HttpSession session = request.getSession(<span style="color: #0000ff;">false</span><span style="color: #000000;">);
        System.out.println(</span>"User="+session.getAttribute("user"<span style="color: #000000;">));
        </span><span style="color: #0000ff;">if</span>(session != <span style="color: #0000ff;">null</span><span style="color: #000000;">){
            session.invalidate();
        }
        </span><span style="color: #008000;">//</span><span style="color: #008000;">no encoding because we have invalidated the session</span>
        response.sendRedirect("login.html"<span style="color: #000000;">);
    }

}</span></span></pre>
</div>
<p><span style="font-family: 楷体;">当我们在禁用Cookie的状况下运行此项目时，将显示如下响应页面，请注意浏览器地址栏URL中的jsessionid。另外请注意，在LoginSuccess页面上，用户名是null，因为浏览器没有发送最后一个响应所发送的cookie。</span></p>
<p><span style="font-family: 楷体;"><img style="clear: both; display: block; margin: auto;" src="http://images2015.cnblogs.com/blog/1042431/201706/1042431-20170605231839965-497078161.png" alt="" /></span></p>
<p><span style="font-family: 楷体;"><img style="clear: both; display: block; margin: auto;" src="http://images2015.cnblogs.com/blog/1042431/201706/1042431-20170605231847731-1498426839.png" alt="" /></span></p>
<p><span style="font-family: 楷体;"><img style="clear: both; display: block; margin: auto;" src="http://images2015.cnblogs.com/blog/1042431/201706/1042431-20170605231854731-880264445.png" alt="" /></span></p>
<p><span style="font-family: 楷体;">如果Cookie未被禁用，你将不会在URL中看到<strong>jsessionid</strong>，因为Servlet Session API会在这种情况下使用cookie。</span></p>
<p><span style="font-family: 楷体;">&nbsp;</span></p>
<p><span style="color: #ff0000; font-family: 楷体;">原文地址：http://www.journaldev.com/1907/java-session-management-servlet-httpsession-url-rewriting</span></p>